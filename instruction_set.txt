VM Instruction Set

## I/O and file manipulation
e STRING -> echo to terminal (impl)
af STRING,PATH -> create/append to file (impl)
wf STRING,PATH -> write/overwrite file
df PATH -> delete file
t PATH -> type file contents
stp IDENT,PROMPT -> Prompt user for IDENT using optional string

## Prompts, setting variables
st IDENT,VALUE -> set IDENT to VALUE (impl)
sta IDENT,EXPR -> arithmetic set (won't implement, substitute math instrs below instead)
stf PATH IDENT -> set variable content from file

## Mathematics (immediate)
adi IDENT,VALUE -> Add [nop]
sbi IDENT,VALUE -> Subtract [nop]
mli IDENT,VALUE -> Multiply [nop]
dvi IDENT,VALUE -> Divide [nop]

## Control flow
g LABEL -> goto (impl)
c PATH -> call [nop]
trm -> terminate (impl)
iex PATH,LABEL -> goto if exist  (impl)
inx PATH,LABEL -> goto if not exist  (impl)
ieq IDENT,VALUE,LABEL -> goto if equal (impl)
inq IDENT,VALUE,LABEL -> goto if not equal (impl)
* If LABEL is unspecified, the following instruction will be executed in the true case or skipped otherwise

## Utility
cls -> clear terminal [nop]
clr INT -> color [nop]
p INT -> pause, quiet pause if INT = 0 (impl)

Built-in identifiers
%username% (impl)
%date% (impl)
%time%  (impl)
%random% (impl)

af "Username: ^%DESUN%","C:\DSOFT\DMS\USERS\USERDATA\ARC\%ARC%.dat"

:systemlog
stf CSYSPASS,"C:\DSOFT\DMS\ADMINTOOLS\SYSPASSWD.txt"
stp SYSTEMPASSWD,"Password:"
ieq CSYSPASS,SYSTEMPASSWD,systemcall
e "invalid."
p
g DMSLOGIN

:GOODARC
clr
e "Your credentials are:"
e ""
t "C:\DSOFT\DMS\USERS\USERDATA\ARC\%ARC%.dat"
e "Please, store these credentials in a safe place!"
e "Press any key to return to login..."
p 0
g DMSLOGIN

## Execution Frame

Header
    Filename
    Entrypoint
    Version
Label Table
    Hash label:index
Variable Table
    Hash identifier:string
Read-Only Strings Table
    Identifier:string 
Instructions
    Array of instructions


## Normalized IR Format

Input

    TEST.BAT

    echo "Hello there!"
    echo "Welcome to the test program."
    set /p NAME=Please enter your name:
    echo %NAME% >>"USERS.TXT"
    if %NAME% EQU "Charlton" goto WAZZUP
    echo "Goodbye, %NAME%"
    exit 

    :WAZZUP 
    echo "Wazzup dad"


.header
    filename "TEST.BAT"
    entry 0
    ver 0.1
.labels 
    WAZZUP:7
.instrs
    e "Hello there!"
    e "Welcome to the test program."
    stp NAME,"Please enter your name:"
    af NAME,"USERS.TXT"
    ieq NAME,"Charlton",WAZZUP
    e "Goodbye, %NAME%"
    trm
    e "Wazzup dad"